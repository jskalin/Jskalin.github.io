<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KYC Admin Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-50 p-8">
    <div class="max-w-4xl mx-auto">
        <div class="bg-white rounded-lg shadow-md p-6 mb-8">
            <h1 class="text-3xl font-bold text-gray-900 mb-2">üöÄ KYC Admin Dashboard</h1>
            <p class="text-gray-600">Send KYC onboarding invitations with SendGrid</p>
        </div>

        <!-- Test SendGrid Button -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-8">
            <h2 class="text-xl font-bold text-gray-900 mb-4">üß™ Test SendGrid Connection</h2>
            <button onclick="testSendGrid()"
                class="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 transition-colors">
                Test SendGrid API
            </button>
            <div id="testResult" class="mt-4"></div>
        </div>

        <!-- Send Invitation Form -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-8">
            <h2 class="text-xl font-bold text-gray-900 mb-6">üì® Send KYC Invitation</h2>

            <div id="messageArea" class="mb-4"></div>

            <form onsubmit="sendInvitation(event)">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Email Address</label>
                        <input type="email" id="email" value="perjonasalexius@gmail.com" required
                            class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Agent Name</label>
                        <input type="text" id="agent_name" value="KYC Admin" required
                            class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md">
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-4 mb-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700">First Name</label>
                        <input type="text" id="first_name" value="Per Jonas" required
                            class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Last Name</label>
                        <input type="text" id="last_name" value="Alexius" required
                            class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md">
                    </div>
                </div>

                <button type="submit"
                    class="w-full bg-blue-600 text-white py-3 px-4 rounded-md hover:bg-blue-700 text-lg font-semibold">
                    üöÄ Send Invitation
                </button>
            </form>
        </div>

        <!-- Quick Send -->
        <div class="bg-gradient-to-r from-blue-500 to-blue-600 rounded-lg shadow-md p-6 text-white">
            <h3 class="text-lg font-bold mb-4">‚ö° Quick Send to Target</h3>
            <p class="mb-4">Send invitation directly to: <strong>perjonasalexius@gmail.com</strong></p>
            <button onclick="quickSend()"
                class="bg-white text-blue-600 px-6 py-2 rounded-lg hover:bg-gray-100 font-semibold">
                üìß Send Now
            </button>
        </div>
    </div>

    <script>
        async function testSendGrid() {
            const resultDiv = document.getElementById('testResult');
            resultDiv.innerHTML = '<p class="text-blue-600">Testing SendGrid connection...</p>';

            try {
                const response = await fetch('http://localhost:8080/api/admin/test-sendgrid', {
                    headers: {
                        'Authorization': 'Bearer dummy-token'
                    }
                });

                const data = await response.json();

                if (data.success) {
                    resultDiv.innerHTML = `<div class="bg-green-50 border border-green-200 rounded-md p-4">
                        <p class="text-green-800">‚úÖ ${data.message}</p>
                    </div>`;
                } else {
                    resultDiv.innerHTML = `<div class="bg-red-50 border border-red-200 rounded-md p-4">
                        <p class="text-red-800">‚ùå ${data.error || data.message}</p>
                    </div>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="bg-red-50 border border-red-200 rounded-md p-4">
                    <p class="text-red-800">‚ùå Network error: ${error.message}</p>
                </div>`;
            }
        }

        async function sendInvitation(event) {
            event.preventDefault();

            const messageArea = document.getElementById('messageArea');
            messageArea.innerHTML = '<p class="text-blue-600">Sending invitation...</p>';

            const formData = {
                email: document.getElementById('email').value,
                first_name: document.getElementById('first_name').value,
                last_name: document.getElementById('last_name').value,
                agent_name: document.getElementById('agent_name').value
            };

            try {
                const response = await fetch('http://localhost:8080/api/admin/send-kyc-invite', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer dummy-token'
                    },
                    body: JSON.stringify(formData)
                });

                const data = await response.json();

                if (data.success) {
                    messageArea.innerHTML = `<div class="bg-green-50 border border-green-200 rounded-md p-4">
                        <p class="text-green-800">‚úÖ ${data.message}</p>
                        <p class="text-green-600 text-sm mt-2">Invitation ID: <code>${data.invitation_id}</code></p>
                        <p class="text-green-600 text-sm">Link: <a href="${data.onboarding_link}" target="_blank" class="underline">${data.onboarding_link}</a></p>
                    </div>`;
                } else {
                    messageArea.innerHTML = `<div class="bg-red-50 border border-red-200 rounded-md p-4">
                        <p class="text-red-800">‚ùå ${data.error || 'Failed to send invitation'}</p>
                    </div>`;
                }
            } catch (error) {
                messageArea.innerHTML = `<div class="bg-red-50 border border-red-200 rounded-md p-4">
                    <p class="text-red-800">‚ùå Network error: ${error.message}</p>
                </div>`;
            }
        }

        async function quickSend() {
            document.getElementById('email').value = 'perjonasalexius@gmail.com';
            document.getElementById('first_name').value = 'Per Jonas';
            document.getElementById('last_name').value = 'Alexius';
            document.getElementById('agent_name').value = 'KYC Admin';

            const event = new Event('submit');
            document.querySelector('form').dispatchEvent(event);
            sendInvitation(event);
        }
    </script>
</body>

</html>